<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>FCC Data Viz Project #4: Scatterplot</title>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes"> 
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
	<style>
		.axis path,
		.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		
		.axis text {
			font-family: sans-serif;
			fill: black;
		}
	
	</style>
</head>

<body>
<!-- 
https://roxorsoxor.com/poprock/forD3/scatterplot/FCC/scattercycle.html

https://learn.freecodecamp.org/data-visualization/data-visualization-projects/visualize-data-with-a-scatterplot-graph 

https://codepen.io/freeCodeCamp/full/bgpXyK
-->

<div id="title"></div>
<div id="forChart"></div>
<script>

const datafile = 'data/cyclist-data.json';
	
const w = 800;
const h = 500;
const margin = {
	top: 25,
	right: 25,
	bottom: 25,
	left: 50
};
	
const strToYear = d3.timeParse('%Y');

/**/
const rowConverter = function(d){
	return {
		time: d.Time,
		place: d.Place,
		seconds: parseInt(d.Seconds),
		name: d.Name,
		year: strToYear(d.Year),
		nationality: d.Nationality,
		doping: d.Doping
	};
};
	
const forTitle = "Doping in Professional Bicycle Racing";
const forSubTitle = "35 Fastest times up Alpe d'Huez";
	
d3.json(datafile, function(dataset) {

	console.log(dataset);
	
	const doper = function (d) {
		let doper = true;
		if (d.Doping = '') {
			doper = false;
		};
		if (d.Doping != '') {
			console.log (d.Doping);
			doper = true; 
		};
		return doper;
	};

	const artistTitle = d3.select("#title")
						  .text(forTitle);

	const firstYear = d3.min(dataset, function(d) { return d.Year; });		
	const lastYear = d3.max(dataset, function(d) { return d.Year; });			  
	
	const xScale = d3.scaleLinear()
					 .domain([
					 firstYear - 1,
					 lastYear + 1
					 ])
					 .range([margin.left, w - margin.right]);

	const yScale = d3.scaleLinear()
					.domain([
						d3.min(dataset, function(d) { return d.Seconds; }),
						d3.max(dataset, function(d) { return d.Seconds; })
					])
					.range([margin.top, h - margin.bottom]);

	var svg = d3.select("#forChart")
		.append("svg")
		.attr("width", w)
		.attr("height", h);

	svg.selectAll("circle")
		.data(dataset)
		.enter()
		.append("circle")
		.attr("cx", function (d) {
			let raceYear = parseInt(d.Year);
			return xScale(raceYear);
		})
		.attr("cy", function(d) {
			let raceTime = parseInt(d.Seconds);
			return yScale(raceTime);			
		})
		.attr("r", 5)
		.style("fill", function (d) {
			if (d.Doping = '') {
				return "orange";
			} else {
				return "blue";
			};
		})
		.attr("data-xvalue", function(d){
			return parseInt(d.Year);
		})
		.attr("data-yvalue", function(d){
			return parseInt(d.Seconds);
		})
		.append("title")
		.text(function(d){
			return d.Name;
		});
	
	const formatYear = d3.format("d");
	
	const xAxis = d3.axisBottom()
					.scale(xScale)
					.tickFormat(formatYear);
	
	const yAxis = d3.axisLeft()
					.scale(yScale)
					.tickFormat(function(d){
						return d3.time.format('%M%L');
					});
	
	svg.append("g")
		.attr("class", "axis")
	   .attr("transform", "translate(0," + (h - margin.bottom) + ")")
	   .call(xAxis);

	svg.append("g")
		.attr("id", "y-axis")
		.attr("transform", "translate(" + margin.left + ",0)")
		.call(yAxis);

	svg.append("g")
	   .attr("id", "legend");

});		
</script>	

</body>

</html>